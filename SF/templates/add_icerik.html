{% extends "admin_layout.html"%}



{% block content %}

<h2 class="my-2">{{ unite.unite }} Ünitesine İçerik Ekleyiniz</h2>
<hr>

<form method="POST" novalidate>
    {{ form.hidden_tag() }}
    <div class="mb-3">
        {{ form.baslik.label }}
        {% if form.baslik.errors %}
        {{ form.baslik(class="form-control is-invalid") }} 
            {% for error in form.baslik.errors %}
                <div class="text-danger">{{ error }}</div>
            {% endfor %}
        {% elif form.baslik.data %}
            {{ form.baslik(class="form-control is-valid") }}
        {% else %}
            {{ form.baslik(class="form-control") }}   
        {% endif %}
    </div>
    <div class="mb-3">
        {{ form.icerik.label(class="form-label") }}
        {{ form.icerik(class="form-control", id="icerik") }}
    </div>
    {{ form.submit(class="btn btn-primary w-100") }}  
</form>

<table class="table table-striped table-hover table-bordered mt-5">
    <thead class="table-dark">
        <tr>
            <th class="text-center">Ünite ID</th>
            <th class="text-center">Ders</th>
            <th class="text-center">Ünite Adı</th>
            <th class="text-center">İşlemler</th>
        </tr>
    </thead>
    <tbody>
        {% for icerik in icerikler %} 
        <tr>
            <td class="text-center">{{ icerik.id }}</td>
            <td class="text-center">{{ icerik.unite.ders.ders_adi }}</td>
            <td>{{ icerik.baslik }}</td>
            <td class="text-center">
                <div class="btn-group">
                <a class="btn btn-info btn-sm" href="{{ url_for('edit_icerik', id=id, sub_id=sub_id, unite_id=unite.id, icerik_id=icerik.id) }}">
                    <i class="fas fa-edit"></i> Güncelle
                </a>
                <button type="button" 
                        class="btn btn-danger btn-sm" 
                        data-bs-toggle="modal" 
                        data-bs-target="#deleteModal{{ icerik.id }}">
                    <i class="fas fa-trash"></i> Sil
                </button>
                </div>
            </td>
        </tr>

        <!-- Her içerik için ayrı modal -->
        <div class="modal fade" 
             id="deleteModal{{ icerik.id }}" 
             tabindex="-1" 
             aria-labelledby="deleteModalLabel{{ icerik.id }}">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">İçerik Silme</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <p>{{ icerik.baslik }} içeriğini silmek istediğinize emin misiniz?</p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                        <form action="{{ url_for('delete_icerik', id=id, sub_id=sub_id, unite_id=unite.id, icerik_id=icerik.id) }}" 
                              method="POST">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-danger">Sil</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </tbody>
</table>

<script src="https://cdn.ckeditor.com/ckeditor5/44.1.0/ckeditor5.umd.js" crossorigin></script>
<script src="{{ url_for('static', filename='main.js') }}"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    window.initCKEditor('#icerik', 'Konu girişini buraya ekleyiniz...');
});
</script>

{% endblock %}

