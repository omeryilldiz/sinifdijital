{% extends "admin_layout.html" %}

{% block content %}

<div class="mb-3">
    <form action="" method="POST" novalidate>
        {{ form.hidden_tag() }}
        <fieldset>
            <legend class="border-bottom">Kayıt Ol</legend>
            <div class="form-group mb-1">
                {{ form.username.label(class="form-label") }}
                {% if form.username.errors %}
                    {{ form.username(class="form-control is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.username.errors %}
                           {{ error }}
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.username(class="form-control") }} 
                {% endif %}
            </div>

            <div class="form-group mt-1">
                {{ form.email.label(class="form-label") }}
                {% if form.email.errors %}
                    {{ form.email(class="form-control is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.email.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.email(class="form-control") }} 
                {% endif %}
            </div>

            <div class="form-group mt-1">
                {{ form.password.label(class="form-label") }}
                {% if form.password.errors %}
                    {{ form.password(class="form-control is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.password.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.password(class="form-control") }} 
                {% endif %}
            </div>

            <div class="form-group mt-1">
                {{ form.confirm_password.label(class="form-label") }}
                {% if form.confirm_password.errors %}
                    {{ form.confirm_password(class="form-control is-invalid") }}
                    <div class="invalid-feedback">
                        {% for error in form.confirm_password.errors %}
                        {{ error }}
                        {% endfor %}
                    </div>
                {% else %}
                    {{ form.confirm_password(class="form-control") }} 
                {% endif %}
            </div>
        </fieldset>
        <div class="form-group mt-3">
            {{ form.submit(class="btn btn-primary") }}
        </div>
    </form>
    <div class="mt-3 ">Zaten bir hesabınız var mı? 
        <a class="text-primary text-decoration-none" href="{{ url_for('admin_login') }}">Giriş yapın.</a>
    </div>
</div>
<hr>
<div class="container mt-5 bg-light p-3 rounded border">
    <h3>Admin Kullanıcıları</h3>
</div>
<table class="table table-striped mt-5">
    <thead>
      <tr>
        <th scope="col">id</th>
        <th scope="col">Adı</th>
        <th scope="col">Rol</th>
        <th scope="col">İşlemler</th>
      </tr>
    </thead>
    {% for admin in admin_users %}
    <tbody>
      <tr>
        <th scope="row">{{ admin.id }}</th>
        <td>{{ admin.username }}</td>
        <td>{{ admin.role }}</td>
        <td>
            <div class="btn-group">
            <a href="{{ url_for('admin_edit', id=admin.id)}}" class="btn btn-sm btn-warning">
                <i class="bi bi-pencil-square"></i>
            </a>
            <!-- Silme butonu -->
            <button type="button" class="btn btn-sm btn-danger" 
                    data-bs-toggle="modal" 
                    data-bs-target="#deleteModal{{ admin.id }}">
                <i class="bi bi-trash-fill" title="Sil"></i>
            </button>
            </div>
                <!-- Her admin için ayrı modal -->
                <div class="modal fade" id="deleteModal{{ admin.id }}" tabindex="-1" 
                    aria-labelledby="deleteModalLabel{{ admin.id }}" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h1 class="modal-title fs-5" id="deleteModalLabel{{ admin.id }}">
                                    Bu İşlem Geri Alınamaz!!!
                                </h1>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <span class="fw-bold text-danger">{{ admin.username }}</span> adlı kullanıcıyı silmek istediğinize emin misiniz?
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">İptal</button>
                                <form action="{{ url_for('admin_delete', id=admin.id) }}" method="POST" class="d-inline">
                                    {{ form.csrf_token }}  <!-- CSRF token eklendi -->
                                    <button type="submit" class="btn btn-danger">Admin Sil</button>
                                </form>
                            </div>
                            </div>
                        </div>
                    </div>
                </td>
      </tr>
    </tbody>
    {% endfor %}
  </table>

{% endblock content %}