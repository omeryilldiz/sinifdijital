{% extends "layout.html" %}
{% from 'includes/ads_macros.html' import render_ad %}

{% block head %}
{{ super() }}
<meta name="csrf-token" content="{{ csrf_token() }}">
{% endblock %}

{% block content %}
<div class="icerik-wrapper">
  <!-- Ana Ä°Ã§erik AlanÄ± -->
  <div class="main-content-area">
    <div class="content-section" data-icerik-id="{{ icerik.id }}">
      <h2 class="content-title">{{ icerik.baslik }}</h2>

      <!-- Pagination Ãœst -->
      <div class="pagination-container my-5">
        <div class="content-pagination">
          <div class="nav-left">
            {% if prev_content_data and prev_content_data.icerik %}
            <a href="{{ url_for('icerik', sinif_slug=sinif.slug, ders_slug=ders.slug, unite_slug=prev_content_data.unite_slug, icerik_slug=prev_content_data.icerik.slug) }}"
               class="btn btn-outline-secondary d-flex align-items-center">
              <i class="bi bi-chevron-left me-2"></i>
              <div class="text-start">
                <small class="fw-medium">{{ prev_content_data.icerik.baslik }}</small>
              </div>
            </a>
            {% endif %}
          </div>
          <span class="position-indicator">{{ current_position }} / {{ total_contents }}</span>
          <div class="nav-right">
            {% if next_content_data and next_content_data.icerik %}
            <a href="{{ url_for('icerik', sinif_slug=sinif.slug, ders_slug=ders.slug, unite_slug=next_content_data.unite_slug, icerik_slug=next_content_data.icerik.slug) }}"
               class="btn btn-outline-secondary d-flex align-items-center">
              <div class="text-end">
                <small class="fw-medium">{{ next_content_data.icerik.baslik }}</small>
              </div>
              <i class="bi bi-chevron-right ms-2"></i>
            </a>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Ders NotlarÄ± -->
      {% if ders_notlari %}
      <div class="pdf-section">
        <h3>Ders NotlarÄ±</h3>
        <div class="pdf-grid">
          {% for ders_notu in ders_notlari %}
          <a href="{{ url_for('static', filename='pdf_uploads/' ~ ders_notu.dosya_adi) }}" target="_blank"
             class="pdf-item text-decoration-none">
            <div class="d-flex align-items-center">
              <i class="bi bi-file-pdf text-danger fs-4 me-2"></i>
              <div>
                <div class="fw-medium text-dark">{{ ders_notu.baslik }}</div>
                <small class="text-muted">{{ ders_notu.eklenme_tarihi.strftime('%d.%m.%Y') }}</small>
              </div>
            </div>
          </a>
          {% endfor %}
        </div>
      </div>
      {% endif %}

      <!-- Ä°Ã§erik GÃ¶vdesi -->
      <div class="content-body mt-4" id="content-body">
        {{ icerik.icerik | safe }}
      </div>

      <!-- VÄ°DEO BÃ–LÃœMÃœ (Ä°Ã§erik gÃ¶vdesinin ALTINDA) -->
      {% if videolar and videolar|length > 0 %}
      <div class="video-section">
        <h4 class="video-section-title">
          <i class="bi bi-play-circle-fill me-2"></i>Ä°lgili Videolar
        </h4>
        <div class="video-scroll-container">
          <div class="video-scroll-wrapper">
            {% for video in videolar %}
            <div class="video-item">
              <div class="video-frame-wrapper">
                <iframe class="video-frame"
                        src="{{ video.embed_url }}"
                        title="{{ video.video_title or ('Video ' ~ loop.index) }}"
                        allowfullscreen
                        loading="lazy">
                </iframe>
              </div>
              <div class="video-info">
                <h5 class="video-title">{{ video.video_title or ('Video ' ~ loop.index) }}</h5>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endif %}
      <!-- VÄ°DEO BÃ–LÃœMÃœ SONU -->

      <!-- ALÄ±ÅTIRMA SORULARI BÃ–LÃœMÃœ -->
      <div class="practice-section mt-4">
        <div class="practice-card">
          <div class="practice-icon">
            <i class="bi bi-pencil-square"></i>
          </div>
          <div class="practice-content">
            <h4 class="practice-title">AlÄ±ÅŸtÄ±rma SorularÄ±</h4>
            <p class="practice-description">Bu konuyu ne kadar Ã¶ÄŸrendiÄŸini test et!</p>
          </div>
          <div class="practice-buttons">
            <a href="{{ url_for('soru_coz', sinif_slug=sinif.slug, ders_slug=ders.slug, icerik_id=icerik.id, adet=5) }}" 
               class="btn btn-practice btn-primary">
              <i class="bi bi-play-circle me-2"></i>5 Soru Ã‡Ã¶z
            </a>
          </div>
        </div>
      </div>

      <!-- Pagination Alt -->
      <div class="pagination-container mt-5">
        <div class="content-pagination">
          <div class="nav-left">
            {% if prev_content_data and prev_content_data.icerik %}
            <a href="{{ url_for('icerik', sinif_slug=sinif.slug, ders_slug=ders.slug, unite_slug=prev_content_data.unite_slug, icerik_slug=prev_content_data.icerik.slug) }}"
               class="btn btn-outline-secondary d-flex align-items-center">
              <i class="bi bi-chevron-left me-2"></i>
              <div class="text-start">
                <small class="fw-medium">{{ prev_content_data.icerik.baslik }}</small>
              </div>
            </a>
            {% endif %}
          </div>
          <span class="position-indicator">{{ current_position }} / {{ total_contents }}</span>
          <div class="nav-right">
            {% if next_content_data and next_content_data.icerik %}
            <a href="{{ url_for('icerik', sinif_slug=sinif.slug, ders_slug=ders.slug, unite_slug=next_content_data.unite_slug, icerik_slug=next_content_data.icerik.slug) }}"
               class="btn btn-outline-secondary d-flex align-items-center">
              <div class="text-end">
                <small class="fw-medium">{{ next_content_data.icerik.baslik }}</small>
              </div>
              <i class="bi bi-chevron-right ms-2"></i>
            </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SAÄ REKLAM KOLONU - DÄ°KEY REKLAMLAR (160x600) -->
  <div class="ad-sidebar-column">
    <!-- 1. Reklam: Normal (Scroll ile kayar) -->
    <div class="ad-sidebar-item">
      {{ render_ad('4030416361', 'Sidebar Dikey Reklam 1', 'vertical', 'display:block; width:160px; height:600px;') }}
    </div>
      <!-- 2. Reklam: Normal (Scroll ile kayar) -->
    <div class="ad-sidebar-item">
      {{ render_ad('9836017636', 'Sidebar Dikey Reklam 2', 'vertical', 'display:block; width:160px; height:600px;') }}
    </div>
    
    <!-- 2. Reklam: Sticky (YapÄ±ÅŸkan) -->
    <div class="ad-sidebar-item ad-sticky">
      <!-- Google AdSense Kodu -->
      <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7728832097527782"
           crossorigin="anonymous"></script>
      <ins class="adsbygoogle"
           style="display:block; width:160px; height:600px;"
           data-ad-client="ca-pub-7728832097527782"
           data-ad-slot="7730930173"
           data-ad-format="vertical"
           data-full-width-responsive="false"></ins>
      <script>
           (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div>
  </div>
</div>

<!-- Mobil Ä°Ã§erik Ä°Ã§i Reklam ÅablonlarÄ± (728x90 Leaderboard) -->
<template id="ad-template-1">
  <div class="in-content-ad my-4">
    {{ render_ad('4030416361', 'Ä°Ã§erik Ä°Ã§i Reklam 1', 'horizontal', 'display:block; width:100%; height:90px;') }}
  </div>
</template>
<template id="ad-template-2">
  <div class="in-content-ad my-4">
    {{ render_ad('5104766834', 'Ä°Ã§erik Ä°Ã§i Reklam 2', 'horizontal', 'display:block; width:100%; height:90px;') }}
  </div>
</template>
<template id="ad-template-3">
  <div class="in-content-ad my-4">
    {{ render_ad('7730930173', 'Ä°Ã§erik Ä°Ã§i Reklam 3', 'horizontal', 'display:block; width:100%; height:90px;') }}
  </div>
</template>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// ========== REKLAM ENJEKSÄ°YON SÄ°STEMÄ° (EÅÄ°T DAÄILIMLI - TABLO SORUNU DÃœZELTÄ°LDÄ°) ==========
(function() {
  const AD_CONFIG = {
    maxAds: 3,
    minParagraphs: 4,
    adPositions: [0.25, 0.50, 0.75],
    isMobile: window.innerWidth < 992
  };

  function injectAdsIntoContent() {
    const contentBody = document.getElementById('content-body');
    if (!contentBody) return;

    if (!AD_CONFIG.isMobile) return;

    // Zaten eklenmiÅŸse tekrar ekleme
    if (contentBody.querySelector('.in-content-ad')) return;

    // Ã–NEMLÄ°: Sadece content-body'nin DOÄRUDAN Ã§ocuklarÄ±nÄ± al
    // Tablo iÃ§indeki p, td gibi elementleri dahil etme
    const allChildren = Array.from(contentBody.children);
    
    // Sadece blok elementleri filtrele (tablo iÃ§indekiler hariÃ§)
    const blockElements = allChildren.filter(el => {
      const tagName = el.tagName.toLowerCase();
      const validTags = ['p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ul', 'ol', 'table', 'blockquote', 'div', 'figure', 'pre'];
      return validTags.includes(tagName);
    });

    const totalElements = blockElements.length;
    
    console.log(`[Ad System] Toplam blok element: ${totalElements}`);
    
    // Ã‡ok az iÃ§erik varsa sadece sona 1 reklam ekle
    if (totalElements < AD_CONFIG.minParagraphs) {
      const adTemplate = document.getElementById('ad-template-1');
      if (adTemplate) {
        const adClone = adTemplate.content.cloneNode(true);
        contentBody.appendChild(adClone);
        refreshAds();
      }
      return;
    }

    // EÅŸit daÄŸÄ±lÄ±mlÄ± reklam pozisyonlarÄ±nÄ± hesapla
    const adTemplates = ['ad-template-1', 'ad-template-2', 'ad-template-3'];
    const insertedPositions = [];

    AD_CONFIG.adPositions.forEach((percentage, index) => {
      if (index >= AD_CONFIG.maxAds) return;

      // Hedef pozisyonu hesapla
      let targetIndex = Math.floor(totalElements * percentage) - 1;
      
      // SÄ±nÄ±rlarÄ± kontrol et
      targetIndex = Math.max(targetIndex, 1);
      targetIndex = Math.min(targetIndex, totalElements - 2);

      // Ã‡akÄ±ÅŸma kontrolÃ¼ (en az 2 element arayla)
      const tooClose = insertedPositions.some(pos => Math.abs(pos - targetIndex) < 2);
      if (tooClose) {
        targetIndex = targetIndex + 2;
        if (targetIndex >= totalElements - 1) return;
      }

      const element = blockElements[targetIndex];
      const adTemplate = document.getElementById(adTemplates[index]);
      
      if (adTemplate && element) {
        const adClone = adTemplate.content.cloneNode(true);
        
        // Elementin SONRASINA ekle (insertAfter mantÄ±ÄŸÄ±)
        // element.parentNode her zaman contentBody olacak
        if (element.nextSibling) {
          contentBody.insertBefore(adClone, element.nextSibling);
        } else {
          contentBody.appendChild(adClone);
        }
        
        insertedPositions.push(targetIndex);
        console.log(`[Ad System] Reklam ${index + 1} eklendi: pozisyon ${targetIndex} (${element.tagName})`);
      }
    });

    refreshAds();
  }

  function refreshAds() {
    if (typeof adsbygoogle !== 'undefined') {
      try {
        const ads = document.querySelectorAll('.in-content-ad .adsbygoogle');
        ads.forEach(ad => {
          if (!ad.getAttribute('data-ad-status')) {
            (adsbygoogle = window.adsbygoogle || []).push({});
          }
        });
      } catch (e) {
        console.log('AdSense refresh error:', e);
      }
    }
  }

  // Sayfa yÃ¼klendiÄŸinde Ã§alÄ±ÅŸtÄ±r
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', injectAdsIntoContent);
  } else {
    injectAdsIntoContent();
  }

  // Resize event - sadece mod deÄŸiÅŸikliÄŸinde
  let resizeTimer;
  window.addEventListener('resize', function() {
    clearTimeout(resizeTimer);
    resizeTimer = setTimeout(function() {
      const wasMobile = AD_CONFIG.isMobile;
      AD_CONFIG.isMobile = window.innerWidth < 992;
      
      if (wasMobile !== AD_CONFIG.isMobile) {
        document.querySelectorAll('.in-content-ad').forEach(el => el.remove());
        injectAdsIntoContent();
      }
    }, 250);
  });
})();

// ========== MEVCUT TIMER SÄ°STEMÄ° ==========

// âœ… CSRF Token'Ä± global scope'ta tanÄ±mla
let csrfToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
window.csrfToken = csrfToken;

// âœ… CSRF Token'Ä± yenileme fonksiyonu
function refreshCSRFToken() {
  const newToken = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
  if (newToken && newToken !== csrfToken) {
    csrfToken = newToken;
    window.csrfToken = csrfToken;
    console.log('[Timer] ğŸ”„ CSRF Token yenilendi:', csrfToken.substring(0, 20) + '...');
    return true;
  }
  return false;
}

// âœ… Sayfa yÃ¼klenmeden Ã¶nce buffer temizle (F5 refresh)
window.addEventListener('beforeunload', () => {
  console.log('[Timer] âš ï¸ beforeunload - buffer temizleniyor');
  localStorage.removeItem('sureBuffer');
});

// Debugging
if (!csrfToken) {
  console.error('[Timer] âŒ CSRF Token bulunamadÄ±! Meta tag kontrol edin.');
} else {
  console.log('[Timer] âœ… CSRF Token yÃ¼klendi:', csrfToken.substring(0, 20) + '...');
}

(function () {
  if (window.timerInterval) {
    clearInterval(window.timerInterval);
    window.timerInterval = null;
  }
  let timerInterval = null;

  const CONTENT_ID = parseInt('{{ icerik.id }}') || null;
  const isAuthenticated = '{{ current_user.is_authenticated }}' === 'True';

  if (!CONTENT_ID || !isAuthenticated) {
    console.warn('[Timer] Content ID veya authentication eksik');
    return;
  }

  console.log('[Timer] âœ… Timer baÅŸlatÄ±lÄ±yor... Content ID:', CONTENT_ID);

  let accumulatedSeconds = 0;
  let lastTick = Date.now();
  let isPageVisible = true;
  let authLost = false;
  let isMarkedAsRead = false;
  const SEND_INTERVAL = 5 * 60000;
  
  // âœ… Sayfa yÃ¼klenince Ã¶nceki buffer'Ä± kontrol et
  let previousBuffer = JSON.parse(localStorage.getItem('sureBuffer') || '[]');
  if (previousBuffer.length > 0) {
    console.log('[Timer] â„¹ï¸ Ã–nceki buffer bulundu:', previousBuffer.length, 'items - retry yapÄ±lacak');
  }

  function bufferDelta(seconds) {
    if (!CONTENT_ID || seconds <= 0) return;
    let buffer = JSON.parse(localStorage.getItem('sureBuffer') || '[]');
    buffer.push({
      icerik_id: CONTENT_ID,
      harcanan_sure: seconds,
      ts: Date.now(),
      activity_type: 'content_reading'
    });
    localStorage.setItem('sureBuffer', JSON.stringify(buffer));
    console.log('[Timer] Buffer updated:', seconds + 's added, total:', buffer.length, 'items');
  }

  function flushBuffer() {
    if (accumulatedSeconds > 0) {
      bufferDelta(accumulatedSeconds);
      accumulatedSeconds = 0;
    }
    let buffer = JSON.parse(localStorage.getItem('sureBuffer') || '[]');
    if (!buffer.length) {
      console.log('[Timer] Buffer boÅŸ, gÃ¶nderme yapÄ±lmadÄ±');
      return;
    }
    
    console.log('[Timer] Buffer flush baÅŸlÄ±yor...', buffer.length, 'items');
    
    // âœ… Her flush'tan Ã¶nce token'Ä± gÃ¼ncelle
    refreshCSRFToken();
    
    fetch('/icerik-sure-kaydet', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'X-CSRFToken': csrfToken
      },
      body: JSON.stringify({ 
        buffer: buffer,
        csrf_token: csrfToken // âœ… Body'ye de ekle (yedek olarak)
      })
    })
    .then(r => {
      console.log('[Timer] Response status:', r.status);
      
      // âœ… 400 CSRF hatasÄ± - buffer temizle ve token yenile
      if (r.status === 400) {
        console.warn('[Timer] âš ï¸ 400 CSRF Error - Buffer temizleniyor, token yenileniyor');
        localStorage.removeItem('sureBuffer');
        refreshCSRFToken();
        return Promise.reject('CSRF validation failed - retrying...');
      }
      
      // âœ… 401 Unauthorized - Session sÃ¼resi doldu
      if (r.status === 401) {
        console.error('[Timer] âŒ 401 Unauthorized - Session sÃ¼resi doldu');
        localStorage.removeItem('sureBuffer');
        handleUnauthorized();
        return Promise.reject('Session expired');
      }
      
      if (!r.ok) {
        throw new Error(`HTTP ${r.status}`);
      }
      return r.json();
    })
    .then(d => {
      console.log('[Timer] Response data:', d);
      if (d?.status === 'success' || d?.success) {
        console.log('[Timer] âœ… Buffer successfully flushed');
        localStorage.removeItem('sureBuffer');
      }
    })
    .catch(err => {
      console.error('[Timer] âŒ Flush error:', err);
    });
  }

  function stopTimer() {
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
      console.log('[Timer] Timer stopped');
    }
  }

  function handleUnauthorized() {
    if (authLost) return;
    authLost = true;
    console.error('[Timer] âš ï¸ Unauthorized - timer stopped');
    stopTimer();
    window.removeEventListener('scroll', onScroll);
  }

  function tick() {
    if (!isPageVisible) return;
    const now = Date.now();
    const elapsed = Math.floor((now - lastTick) / 1000);
    lastTick = now;
    const seconds = Math.max(1, Math.min(elapsed, 35));
    accumulatedSeconds += seconds;
    window.accumulatedSeconds = accumulatedSeconds;
  }

  function startTimer() {
    stopTimer();
    timerInterval = setInterval(tick, 1000);
    console.log('[Timer] Timer started');
  }

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', function() {
      startTimer();
      // âœ… Token yenilendikten sonra flush et (Ã¶nceki buffer varsa retry)
      setTimeout(() => {
        refreshCSRFToken();
        flushBuffer();
      }, 1000);
    }, { once: true });
  } else {
    startTimer();
    // âœ… Token yenilendikten sonra flush et (Ã¶nceki buffer varsa retry)
    setTimeout(() => {
      refreshCSRFToken();
      flushBuffer();
    }, 1000);
  }

  setInterval(flushBuffer, SEND_INTERVAL);

  document.addEventListener('visibilitychange', () => {
    if (authLost) return;
    const now = Date.now();
    if (document.visibilityState === 'hidden') {
      isPageVisible = false;
      const elapsed = Math.floor((now - lastTick) / 1000);
      if (elapsed > 0) {
        accumulatedSeconds += elapsed;
      }
      stopTimer();
      flushBuffer();
    } else if (document.visibilityState === 'visible') {
      isPageVisible = true;
      lastTick = now;
      startTimer();
    }
  });

  window.addEventListener('pagehide', function () {
    if (accumulatedSeconds > 0) {
      bufferDelta(accumulatedSeconds);
      accumulatedSeconds = 0;
    }
    let buffer = JSON.parse(localStorage.getItem('sureBuffer') || '[]');
    if (!buffer.length) return;

    // âœ… CSRF Token'Ä± payload'a ekle (sendBeacon header gÃ¶nderemez)
    const payload = JSON.stringify({ 
      buffer: buffer,
      csrf_token: csrfToken 
    });
    const headers = { type: 'application/json' };

    if (navigator.sendBeacon) {
      const blob = new Blob([payload], headers);
      // âœ… sendBeacon baÅŸarÄ±sÄ±nÄ± kontrol et
      const success = navigator.sendBeacon('/icerik-sure-kaydet', blob);
      
      if (success) {
        // âœ… BaÅŸarÄ±lÄ± olmuÅŸsa buffer'Ä± temizle
        localStorage.removeItem('sureBuffer');
        console.log('[Timer] âœ… sendBeacon baÅŸarÄ±lÄ± - buffer temizlendi');
      } else {
        // âš ï¸ BaÅŸarÄ±sÄ±z olmuÅŸsa buffer'da kalÄ±yor (retry iÃ§in)
        console.warn('[Timer] âš ï¸ sendBeacon baÅŸarÄ±sÄ±z - buffer korunuyor');
        // Buffer localStorage'da kalÄ±yor, sonraki sayfa ziyaretinde retry edilecek
      }
    } else {
      // Fallback: normal fetch kullan
      console.log('[Timer] sendBeacon desteklenmiyor, flushBuffer kullanÄ±lÄ±yor');
      flushBuffer();
    }
  });

  function markContentAsRead() {
    if (authLost || isMarkedAsRead) return;
    isMarkedAsRead = true;
    console.log('[Timer] Marking content as read...');
    
    // âœ… Token'Ä± gÃ¼ncelle
    refreshCSRFToken();
    
    fetch(`/mark_content_read/${CONTENT_ID}`, {
      method: 'POST',
      headers: { 'X-CSRFToken': csrfToken }
    })
    .then(r => {
      // âœ… 400 CSRF hatasÄ±
      if (r.status === 400) {
        console.warn('[Timer] âš ï¸ 400 CSRF Error - Token yenileniyor');
        refreshCSRFToken();
        isMarkedAsRead = false; // Retry etmesine izin ver
        return Promise.reject('CSRF validation failed');
      }
      
      // âœ… 401 Unauthorized
      if (r.status === 401) { 
        console.error('[Timer] âŒ 401 Unauthorized');
        handleUnauthorized(); 
        throw new Error('Unauthorized'); 
      }
      return r.ok ? r.json() : Promise.reject(r);
    })
    .then(d => {
      console.log('[Timer] Content marked as read');
      if (!(d?.success || d?.status === 'success')) isMarkedAsRead = false;
    })
    .catch(err => { 
      console.error('[Timer] Error marking as read:', err);
      isMarkedAsRead = false; 
    });
  }

  function onScroll() {
    if (isMarkedAsRead || authLost) return;
    const maxScroll = document.body.scrollHeight - window.innerHeight;
    if (maxScroll <= 0) return;
    const percent = (window.scrollY / maxScroll) * 100;
    if (percent >= 80) markContentAsRead();
  }

  window.accumulatedSeconds = accumulatedSeconds;
  window.flushBuffer = flushBuffer;
  window.startTimer = startTimer;
  window.addEventListener('scroll', onScroll);
})();
</script>
{% endblock %}

{% block styles %}
{{ super() }}
<style>
/* ========== KRÄ°TÄ°K DÃœZELTME: STICKY Ä°Ã‡Ä°N OVERFLOW RESET ========== */
/* layout.html'deki .content-main sÄ±nÄ±fÄ±nda bulunan overflow-y: auto; 
   sticky elementin Ã§alÄ±ÅŸmasÄ±nÄ± engelliyor. Bunu visible yaparak dÃ¼zeltiyoruz. */
.content-main {
  overflow: visible !important;
}

/* ========== ANA WRAPPER ========== */
.icerik-wrapper {
  display: flex;
  gap: 15px;
  max-width: 100%;
  /* Sticky'nin Ã§alÄ±ÅŸmasÄ± iÃ§in sidebar'Ä±n ana iÃ§erik kadar uzamasÄ± gerekir */
  align-items: stretch; 
}

/* ========== ANA Ä°Ã‡ERÄ°K ALANI ========== */
.main-content-area {
  flex: 1;
  min-width: 0;
  padding: 20px;
}

/* ========== SAÄ REKLAM KOLONU (160px geniÅŸlik) ========== */
.ad-sidebar-column {
  flex: 0 0 160px;
  width: 160px;
  display: flex;
  flex-direction: column;
  align-items: center;
  /* Ä°ki reklam arasÄ±ndaki boÅŸluk */
  gap: 40px; 
  padding: 20px 0;
  /* Sticky'nin Ã§alÄ±ÅŸmasÄ± iÃ§in kolonun yÃ¼ksekliÄŸi parent kadar olmalÄ± */
  height: 100%;
}

/* TÃ¼m sidebar reklamlarÄ± 160x600 */
.ad-sidebar-item {
  width: 160px;
  height: 600px;
  background: #f8f9fa;
  border: 1px dashed #ddd;
  border-radius: 8px;
  overflow: hidden;
  display: flex;
  justify-content: center;
  align-items: flex-start;
  flex-shrink: 0;
}

/* Ä°lk reklam - Normal (scroll ile kayar) */
.ad-sidebar-item:first-child {
  position: relative;
  z-index: 1;
}

/* Ä°kinci reklam - Sticky (yapÄ±ÅŸkan) */
.ad-sidebar-item.ad-sticky {
  position: -webkit-sticky;
  position: sticky;
  /* Navbar (60px) + SÄ±nÄ±f Bar (50px) + 10px boÅŸluk = 120px */
  top: 120px; 
  z-index: 100;
  margin-bottom: 20px;
}

/* ========== Ä°Ã‡ERÄ°K Ä°Ã‡Ä° REKLAMLAR (YATAY - 728x90) ========== */
.in-content-ad {
  background: #f8f9fa;
  border: 1px dashed #ddd;
  border-radius: 8px;
  overflow: hidden;
  text-align: center;
  width: 100%;
  max-width: 728px;
  height: 90px;
  margin: 1.5rem auto;
}

/* ========== MASAÃœSTÃœ (â‰¥992px) ========== */
@media (min-width: 992px) {
  .ad-sidebar-column {
    display: flex;
  }
  
  .in-content-ad {
    display: none !important;
  }
}

/* ========== TABLET (768px - 991px) ========== */
@media (min-width: 768px) and (max-width: 991.98px) {
  .icerik-wrapper {
    flex-direction: column;
  }
  
  .ad-sidebar-column {
    display: none !important;
  }
  
  .in-content-ad {
    display: block !important;
    max-width: 728px;
    height: 90px;
  }
}

/* ========== MOBÄ°L (<768px) ========== */
@media (max-width: 767.98px) {
  .icerik-wrapper {
    flex-direction: column;
  }
  
  .main-content-area {
    padding: 15px;
  }
  
  .ad-sidebar-column {
    display: none !important;
  }
  
  .in-content-ad {
    display: block !important;
    max-width: 320px;
    height: 100px;
    margin: 1rem auto;
  }
}

/* ========== Ä°Ã‡ERÄ°K BÃ–LÃœMÃœ ========== */
.content-section {
  background: white;
  border-radius: 8px;
  padding: 24px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.content-title {
  color: var(--primary-color);
  margin-bottom: 1rem;
}

/* ========== PAGÄ°NATION ========== */
.pagination-container {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.content-pagination {
  display: flex;
  justify-content: space-between;
  align-items: center;
  width: 100%;
}

.content-pagination .btn {
  max-width: 200px;
  text-decoration: none;
  border: 1px solid #dee2e6;
  padding: 12px 16px;
  border-radius: 8px;
  transition: all 0.2s ease;
}

.content-pagination .btn:hover {
  background-color: #f8f9fa;
  border-color: #adb5bd;
  transform: translateY(-1px);
}

.content-pagination .btn .fw-medium {
  font-size: 0.9rem;
  line-height: 1.2;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
}

.position-indicator {
  font-weight: bold;
  color: #666;
}

@media (max-width: 768px) {
  .content-pagination {
    flex-direction: column;
    gap: 10px;
  }
  
  .content-pagination .btn {
    max-width: 100%;
    width: 100%;
  }
  
  .position-indicator {
    order: -1;
    margin-bottom: 10px;
  }
  
  .content-section {
    padding: 16px;
  }
}

/* ========== VÄ°DEO ALANI (Viewport tabanlÄ± yÃ¼kseklik) ========== */
.video-container {
  margin: 24px 0;
  max-width: 1100px;
  margin-left: auto;
  margin-right: auto;
  padding: 0 12px;
}

/* ========== VÄ°DEO BÃ–LÃœMÃœ (Yatay KaydÄ±rmalÄ±) ========== */
.video-section {
  margin-top: 2rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border-radius: 12px;
  border-left: 4px solid var(--primary-color);
}

.video-section-title {
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--primary-color);
  display: flex;
  align-items: center;
}

/* Yatay kaydÄ±rma container */
.video-scroll-container {
  width: 100%;
  overflow: hidden;
}

.video-scroll-wrapper {
  display: flex;
  gap: 1rem;
  overflow-x: auto;
  overflow-y: hidden;
  padding-bottom: 12px;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
}

/* Scrollbar stilleri */
.video-scroll-wrapper::-webkit-scrollbar {
  height: 8px;
}

.video-scroll-wrapper::-webkit-scrollbar-track {
  background: #e9ecef;
  border-radius: 4px;
}

.video-scroll-wrapper::-webkit-scrollbar-thumb {
  background: var(--primary-color);
  border-radius: 4px;
}

.video-scroll-wrapper::-webkit-scrollbar-thumb:hover {
  background: #003a66;
}

/* Video kartlarÄ± - min %20, max %40 geniÅŸlik */
.video-item {
  flex: 0 0 auto;
  width: clamp(20vw, 30vw, 40vw);
  min-width: 250px;
  max-width: 500px;
  background: white;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 4px 12px rgba(0,0,0,0.08);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.video-item:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 20px rgba(0,0,0,0.12);
}

/* Video Ã§erÃ§evesi - 16:9 oranÄ± */
.video-frame-wrapper {
  position: relative;
  padding-bottom: 56.25%; /* 16:9 aspect ratio */
  height: 0;
  overflow: hidden;
  background: #000;
}

.video-frame {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  border: none;
}

.video-info {
  padding: 12px 14px;
}

.video-title {
  margin: 0;
  font-size: 0.9rem;
  font-weight: 500;
  color: #333;
  line-height: 1.3;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}

/* ========== MASAÃœSTÃœ (â‰¥1200px) - min %20 ========== */
@media (min-width: 1200px) {
  .video-item {
    width: clamp(20vw, 25vw, 30vw);
    min-width: 280px;
    max-width: 450px;
  }
}

/* ========== TABLET (768px - 1199px) - %30 ========== */
@media (min-width: 768px) and (max-width: 1199.98px) {
  .video-item {
    width: clamp(25vw, 35vw, 40vw);
    min-width: 260px;
    max-width: 400px;
  }
}

/* ========== MOBÄ°L (<768px) - max %40 ========== */
@media (max-width: 767.98px) {
  .video-section {
    margin-top: 1.5rem;
    padding: 1rem;
    border-radius: 8px;
  }
  
  .video-section-title {
    font-size: 1rem;
  }
  
  .video-item {
    width: clamp(35vw, 40vw, 45vw);
    min-width: 220px;
    max-width: 300px;
  }
  
  .video-info {
    padding: 10px 12px;
  }
  
  .video-title {
    font-size: 0.85rem;
  }
}

/* ========== Ã‡OK DAR EKRAN (<480px) ========== */
@media (max-width: 480px) {
  .video-item {
    width: 70vw;
    min-width: 200px;
    max-width: 280px;
  }
}

/* ========== PDF BÃ–LÃœMÃœ ========== */
.pdf-section {
  margin: 20px 0;
  padding: 15px;
  background: #f8f9fa;
  border-radius: 8px;
}

.pdf-grid {
  display: grid;
  gap: 10px;
}

.pdf-item {
  padding: 10px;
  background: white;
  border-radius: 6px;
  transition: all 0.2s;
}

.pdf-item:hover {
  background: #e9ecef;
  transform: translateX(5px);
}

/* ========== Ä°Ã‡ERÄ°K GÃ–VDESÄ° ========== */
.content-body {
  line-height: 1.8;
  font-size: 1.05rem;
}

.content-body p {
  margin-bottom: 1rem;
}

.content-body h2, .content-body h3, .content-body h4 {
  margin-top: 1.5rem;
  margin-bottom: 1rem;
  color: var(--primary-color);
}

/* ========== CKEDITOR RESÄ°M STÄ°LLERÄ° ========== */
.content-body img {
    max-width: 60% !important;
    height: auto !important;
    display: block;
    margin: 1rem auto;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

/* CKEditor'Ã¼n resim sÄ±nÄ±flarÄ± */
.content-body .image,
.content-body figure.image {
    max-width: 100% !important;
    margin: 1.5rem auto;
    text-align: center;
}

.content-body figure.image img {
    max-width: 100% !important;
    height: auto !important;
}

.content-body figure.image figcaption {
    font-size: 0.85rem;
    color: #6c757d;
    margin-top: 0.5rem;
    font-style: italic;
}

/* Resim hizalama (CKEditor sÄ±nÄ±flarÄ±) */
.content-body .image-style-align-left,
.content-body .image.image_resized[style*="float:left"] {
    float: left;
    margin: 0.5rem 1.5rem 1rem 0;
    max-width: 50%;
}

.content-body .image-style-align-right,
.content-body .image.image_resized[style*="float:right"] {
    float: right;
    margin: 0.5rem 0 1rem 1.5rem;
    max-width: 50%;
}

.content-body .image-style-align-center {
    margin: 1.5rem auto;
    display: block;
}

/* Mobil: Float'larÄ± kaldÄ±r, tam geniÅŸlik yap */
@media (max-width: 768px) {
    .content-body img {
        max-width: 100% !important;
        margin: 1rem 0;
    }
    
    .content-body .image-style-align-left,
    .content-body .image-style-align-right,
    .content-body .image.image_resized {
        float: none !important;
        margin: 1rem 0 !important;
        max-width: 100% !important;
        width: 100% !important;
    }
}

/* ========== SORU BÃ–LÃœMÃœ ========== */
.question-section {
  margin-top: 2rem;
  padding: 1.5rem;
  background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
  border-radius: 12px;
  border-left: 4px solid #ff9800;
}

.question-section .section-title {
  margin: 0 0 1rem 0;
  font-size: 1.1rem;
  font-weight: 600;
  color: #e65100;
  display: flex;
  align-items: center;
}

.question-list {
  display: flex;
  flex-direction: column;
  gap: 0.5rem;
}

.question-item {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  background: white;
  border-radius: 8px;
  text-decoration: none;
  color: #333;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.question-item:hover {
  transform: translateX(5px);
  box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  background: #fff8e1;
}

.question-number {
  width: 28px;
  height: 28px;
  background: #ff9800;
  color: white;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  font-size: 0.85rem;
  margin-right: 12px;
  flex-shrink: 0;
}

.question-text {
  flex: 1;
  font-weight: 500;
}

.question-item .bi-chevron-right {
  color: #999;
  transition: transform 0.2s;
}

.question-item:hover .bi-chevron-right {
  transform: translateX(3px);
  color: #ff9800;
}

/* ========== ALIÅTIRMA SORULARI BÃ–LÃœMÃœ ========== */
.practice-section {
  margin-top: 2rem;
  margin-bottom: 2rem;
}

.practice-card {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  padding: 1.5rem 2rem;
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  border-radius: 16px;
  border-left: 5px solid #1976d2;
  box-shadow: 0 4px 15px rgba(25, 118, 210, 0.15);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.practice-card:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(25, 118, 210, 0.2);
}

.practice-icon {
  flex-shrink: 0;
  width: 60px;
  height: 60px;
  background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
  box-shadow: 0 4px 10px rgba(25, 118, 210, 0.3);
}

.practice-content {
  flex: 1;
}

.practice-title {
  margin: 0 0 0.25rem 0;
  font-size: 1.2rem;
  font-weight: 700;
  color: #1565c0;
}

.practice-description {
  margin: 0;
  font-size: 0.95rem;
  color: #546e7a;
}

.practice-buttons {
  display: flex;
  gap: 0.75rem;
  flex-shrink: 0;
}

.btn-practice {
  padding: 0.75rem 1.5rem;
  font-weight: 600;
  border-radius: 25px;
  transition: all 0.3s ease;
  white-space: nowrap;
}

.btn-practice.btn-primary {
  background: linear-gradient(135deg, #1976d2 0%, #1565c0 100%);
  border: none;
  box-shadow: 0 4px 10px rgba(25, 118, 210, 0.3);
}

.btn-practice.btn-primary:hover {
  background: linear-gradient(135deg, #1565c0 0%, #0d47a1 100%);
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(25, 118, 210, 0.4);
}

.btn-practice.btn-outline-primary {
  border: 2px solid #1976d2;
  color: #1976d2;
  background: white;
}

.btn-practice.btn-outline-primary:hover {
  background: #1976d2;
  color: white;
  transform: translateY(-2px);
}

/* ========== MOBÄ°L UYUM ========== */
@media (max-width: 768px) {
  .practice-card {
    flex-direction: column;
    text-align: center;
    padding: 1.25rem;
    gap: 1rem;
  }
  
  .practice-icon {
    width: 50px;
    height: 50px;
    font-size: 1.25rem;
  }
  
  .practice-title {
    font-size: 1.1rem;
  }
  
  .practice-description {
    font-size: 0.9rem;
  }
  
  .practice-buttons {
    flex-direction: column;
    width: 100%;
  }
  
  .btn-practice {
    width: 100%;
    padding: 0.875rem 1rem;
  }
}
</style>
{% endblock %}